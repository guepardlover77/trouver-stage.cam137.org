{"version":3,"mappings":";4HASA,IAAIA,EAAa,KACbC,EAAiB,KAErB,eAAeC,GAAY,CACzB,GAAI,CAACF,EAAO,CACV,MAAMG,EAAS,YAAM,OAAO,sBAAO,OAAAC,KAAA,2CACnCJ,EAAQG,EAAO,SAAWA,EAAO,MAEjCF,GADwB,MAAAI,EAAA,IAAM,OAAO,sBAAiB,OAAAD,KAAA,4CAC1B,OAC9B,CACA,MAAO,CAAE,MAAAJ,EAAO,UAAAC,CAAA,CAClB,CAKO,SAASK,EAAYC,EAAuBC,EAAyB,CAC1E,MAAMC,EAAU,CACd,MACA,UACA,cACA,QACA,OACA,SACA,YACA,UACA,QACA,cACA,WACA,aAGIC,EAAOH,EAAU,IAAII,GAAA,SAAO,OAChCC,EAAeD,EAAI,GAAG,EACtBC,EAAeD,EAAI,OAAO,EAC1BA,EAAI,WACJC,EAAeD,EAAI,KAAK,EACxBC,EAAeD,EAAI,IAAI,EACvBA,EAAI,OACJA,EAAI,UACJC,EAAeD,EAAI,OAAO,EAC1BA,EAAI,MACJC,EAAeD,EAAI,WAAW,IAC9BE,EAAAF,EAAI,MAAJ,YAAAE,EAAS,aAAc,KACvBC,EAAAH,EAAI,MAAJ,YAAAG,EAAS,aAAc,IACxB,EAIKC,EADM,SACa,CACvBN,EAAQ,KAAK,GAAG,EAChB,GAAGC,EAAK,OAAWM,EAAI,KAAK,GAAG,CAAC,GAChC,KAAK;AAAA,CAAI,EAEXC,EACEF,EACYG,EAAiB,cAAe,KAAK,EACjD,yBAEJ,CAKA,SAASN,EAAeO,EAAuB,CAC7C,OAAKA,EAEDA,EAAM,SAAS,GAAG,GAAKA,EAAM,SAAS,GAAG,GAAKA,EAAM,SAAS;AAAA,CAAI,EAC5D,IAAIA,EAAM,QAAQ,KAAM,IAAI,CAAC,IAE/BA,EALY,EAMrB,CAKO,SAASC,EAAab,EAAuBC,EAAyB,CAC3E,MAAMa,EAAc,KAAK,UAAUd,EAAW,KAAM,CAAC,EAErDU,EACEI,EACYH,EAAiB,cAAe,MAAM,EAClD,mBAEJ,CAKA,eAAsBI,EACpBf,EACAgB,EAII,GACW,CACf,KAAM,CAAE,MAAAvB,GAAU,MAAME,EAAA,EAElB,CACJ,MAAAsB,EAAQ,2BACR,SAAAhB,EAAWU,EAAiB,cAAe,KAAK,GAC9CK,EAEEE,EAAM,IAAIzB,EAAM,CACpB,YAAa,YACb,KAAM,KACN,OAAQ,KACT,EAGDyB,EAAI,YAAY,EAAE,EAClBA,EAAI,QAAQ,YAAa,MAAM,EAC/BA,EAAI,KAAKD,EAAO,GAAI,EAAE,EAGtBC,EAAI,YAAY,EAAE,EAClBA,EAAI,QAAQ,YAAa,QAAQ,EACjCA,EAAI,KAAK,aAAaC,EAAA,CAAc,GAAI,GAAI,EAAE,EAC9CD,EAAI,KAAK,GAAGlB,EAAU,MAAM,oBAAqB,GAAI,EAAE,EAGvD,MAAMoB,EAAYpB,EAAU,IAAII,GAAO,CACrCA,EAAI,KAAO,GACXA,EAAI,SAAW,GACf,GAAGA,EAAI,UAAU,IAAIA,EAAI,KAAK,GAC9BA,EAAI,MAAQ,GACZA,EAAI,QAAU,GACdA,EAAI,WAAa,GACjBA,EAAI,SAAW,GAChB,EAEAc,EAAY,UAAU,CACrB,OAAQ,GACR,KAAM,CAAC,CAAC,MAAO,UAAW,QAAS,OAAQ,SAAU,YAAa,SAAS,CAAC,EAC5E,KAAME,EACN,OAAQ,CACN,SAAU,EACV,YAAa,GAEf,WAAY,CACV,UAAW,CAAC,GAAI,GAAI,GAAG,EACvB,UAAW,IACX,UAAW,QAEb,mBAAoB,CAClB,UAAW,CAAC,IAAK,IAAK,GAAG,GAE3B,aAAc,CACZ,EAAG,CAAE,UAAW,IAChB,EAAG,CAAE,UAAW,IAChB,EAAG,CAAE,UAAW,IAChB,EAAG,CAAE,UAAW,IAChB,EAAG,CAAE,UAAW,IAChB,EAAG,CAAE,UAAW,IAChB,EAAG,CAAE,UAAW,GAAG,CACrB,CACD,EAGD,MAAMC,EAAYH,EAAI,mBACtB,QAASI,EAAI,EAAGA,GAAKD,EAAWC,IAC9BJ,EAAI,QAAQI,CAAC,EACbJ,EAAI,YAAY,CAAC,EACjBA,EAAI,aAAa,GAAG,EACpBA,EAAI,KACF,QAAQI,CAAC,MAAMD,CAAS,GACxBH,EAAI,SAAS,SAAS,MAAQ,GAC9BA,EAAI,SAAS,SAAS,OAAS,IAInCA,EAAI,KAAKjB,CAAQ,CACnB,CA4LA,SAASS,EAAaa,EAAiBtB,EAAkBuB,EAAwB,CAC/E,MAAMC,EAAO,IAAI,KAAK,CAACF,CAAO,EAAG,CAAE,KAAMC,EAAU,EAC7CE,EAAM,IAAI,gBAAgBD,CAAI,EAE9BE,EAAO,SAAS,cAAc,GAAG,EACvCA,EAAK,KAAOD,EACZC,EAAK,SAAW1B,EAChB0B,EAAK,MAAM,QAAU,OAErB,SAAS,KAAK,YAAYA,CAAI,EAC9BA,EAAK,QACL,SAAS,KAAK,YAAYA,CAAI,EAE9B,IAAI,gBAAgBD,CAAG,CACzB,CAqFA,eAAsBE,EAAYC,EAAkC,CAClE,MAAM7B,EAAY6B,EAAQ,IAAIP,GAAKQ,EAAM,UAAUR,CAAC,CAAC,EAAE,OAAO,OAAO,EACrEvB,EAAYC,CAAS,CACvB,CAKA,eAAsB+B,EAAaF,EAAkC,CACnE,MAAM7B,EAAY6B,EAAQ,IAAIP,GAAKQ,EAAM,UAAUR,CAAC,CAAC,EAAE,OAAO,OAAO,EACrET,EAAab,CAAS,CACxB,CAKA,eAAsBgC,EAAYH,EAAkC,CAClE,MAAM7B,EAAY6B,EAAQ,IAAIP,GAAKQ,EAAM,UAAUR,CAAC,CAAC,EAAE,OAAO,OAAO,EACrE,MAAMP,EAAYf,CAAS,CAC7B","names":["jsPDF","autoTable","loadJsPDF","module","n","__vitePreload","exportToCSV","locations","filename","headers","rows","loc","escapeCsvField","_a","_b","csvContent","row","downloadFile","generateFileName","value","exportToJSON","jsonContent","exportToPDF","options","title","doc","formatDateFR","tableData","pageCount","i","content","mimeType","blob","url","link","exportAsCsv","indices","store","exportAsJson","exportAsPdf"],"ignoreList":[],"sources":["../../src/services/export.service.ts"],"sourcesContent":["// ============================================================================\n// Service d'export (CSV, JSON, PDF, Excel)\n// ============================================================================\n\nimport type { Location } from '../types';\nimport { generateFileName, formatDateFR } from '../utils/helpers';\nimport { store } from '../store';\n\n// Imports dynamiques pour réduire la taille du bundle initial\nlet jsPDF: any = null;\nlet autoTable: any = null;\n\nasync function loadJsPDF() {\n  if (!jsPDF) {\n    const module = await import('jspdf');\n    jsPDF = module.default || module.jsPDF;\n    const autoTableModule = await import('jspdf-autotable');\n    autoTable = autoTableModule.default;\n  }\n  return { jsPDF, autoTable };\n}\n\n/**\n * Exporte les données en CSV\n */\nexport function exportToCSV(locations: Location[], filename?: string): void {\n  const headers = [\n    'Nom',\n    'Adresse',\n    'Code Postal',\n    'Ville',\n    'Type',\n    'Niveau',\n    'Téléphone',\n    'Contact',\n    'Email',\n    'Commentaire',\n    'Latitude',\n    'Longitude'\n  ];\n\n  const rows = locations.map(loc => [\n    escapeCsvField(loc.nom),\n    escapeCsvField(loc.adresse),\n    loc.codePostal,\n    escapeCsvField(loc.ville),\n    escapeCsvField(loc.type),\n    loc.niveau,\n    loc.telephone,\n    escapeCsvField(loc.contact),\n    loc.email,\n    escapeCsvField(loc.commentaire),\n    loc.lat?.toString() || '',\n    loc.lon?.toString() || ''\n  ]);\n\n  // Ajouter BOM pour UTF-8\n  const BOM = '\\uFEFF';\n  const csvContent = BOM + [\n    headers.join(';'),\n    ...rows.map(row => row.join(';'))\n  ].join('\\n');\n\n  downloadFile(\n    csvContent,\n    filename || generateFileName('lieux-stage', 'csv'),\n    'text/csv;charset=utf-8'\n  );\n}\n\n/**\n * Échappe un champ CSV\n */\nfunction escapeCsvField(value: string): string {\n  if (!value) return '';\n  // Échapper les guillemets et entourer si nécessaire\n  if (value.includes('\"') || value.includes(';') || value.includes('\\n')) {\n    return `\"${value.replace(/\"/g, '\"\"')}\"`;\n  }\n  return value;\n}\n\n/**\n * Exporte les données en JSON\n */\nexport function exportToJSON(locations: Location[], filename?: string): void {\n  const jsonContent = JSON.stringify(locations, null, 2);\n\n  downloadFile(\n    jsonContent,\n    filename || generateFileName('lieux-stage', 'json'),\n    'application/json'\n  );\n}\n\n/**\n * Exporte les données en PDF\n */\nexport async function exportToPDF(\n  locations: Location[],\n  options: {\n    title?: string;\n    filename?: string;\n    includeMap?: boolean;\n  } = {}\n): Promise<void> {\n  const { jsPDF } = await loadJsPDF();\n\n  const {\n    title = 'Liste des Lieux de Stage',\n    filename = generateFileName('lieux-stage', 'pdf')\n  } = options;\n\n  const doc = new jsPDF({\n    orientation: 'landscape',\n    unit: 'mm',\n    format: 'a4'\n  });\n\n  // Titre\n  doc.setFontSize(16);\n  doc.setFont('helvetica', 'bold');\n  doc.text(title, 14, 15);\n\n  // Date\n  doc.setFontSize(10);\n  doc.setFont('helvetica', 'normal');\n  doc.text(`Export du ${formatDateFR()}`, 14, 22);\n  doc.text(`${locations.length} établissement(s)`, 14, 27);\n\n  // Tableau\n  const tableData = locations.map(loc => [\n    loc.nom || '',\n    loc.adresse || '',\n    `${loc.codePostal} ${loc.ville}`,\n    loc.type || '',\n    loc.niveau || '',\n    loc.telephone || '',\n    loc.contact || ''\n  ]);\n\n  (doc as any).autoTable({\n    startY: 32,\n    head: [['Nom', 'Adresse', 'Ville', 'Type', 'Niveau', 'Téléphone', 'Contact']],\n    body: tableData,\n    styles: {\n      fontSize: 8,\n      cellPadding: 2\n    },\n    headStyles: {\n      fillColor: [37, 99, 235], // primary-600\n      textColor: 255,\n      fontStyle: 'bold'\n    },\n    alternateRowStyles: {\n      fillColor: [248, 250, 252] // slate-50\n    },\n    columnStyles: {\n      0: { cellWidth: 45 }, // Nom\n      1: { cellWidth: 50 }, // Adresse\n      2: { cellWidth: 35 }, // Ville\n      3: { cellWidth: 35 }, // Type\n      4: { cellWidth: 15 }, // Niveau\n      5: { cellWidth: 30 }, // Téléphone\n      6: { cellWidth: 35 }  // Contact\n    }\n  });\n\n  // Pied de page\n  const pageCount = doc.getNumberOfPages();\n  for (let i = 1; i <= pageCount; i++) {\n    doc.setPage(i);\n    doc.setFontSize(8);\n    doc.setTextColor(128);\n    doc.text(\n      `Page ${i} / ${pageCount}`,\n      doc.internal.pageSize.width - 20,\n      doc.internal.pageSize.height - 10\n    );\n  }\n\n  doc.save(filename);\n}\n\n/**\n * Exporte une fiche individuelle en PDF\n */\nexport async function exportLocationToPDF(\n  location: Location,\n  options: {\n    includeQRCode?: boolean;\n    includeMap?: boolean;\n    personalNote?: string;\n  } = {}\n): Promise<void> {\n  const { jsPDF } = await loadJsPDF();\n  const { includeQRCode = true, personalNote } = options;\n\n  const doc = new jsPDF({\n    orientation: 'portrait',\n    unit: 'mm',\n    format: 'a4'\n  });\n\n  const pageWidth = doc.internal.pageSize.width;\n  const margin = 20;\n  let y = 20;\n\n  // Titre\n  doc.setFontSize(20);\n  doc.setFont('helvetica', 'bold');\n  doc.setTextColor(37, 99, 235);\n  doc.text(location.nom, margin, y);\n  y += 10;\n\n  // Type\n  doc.setFontSize(12);\n  doc.setFont('helvetica', 'normal');\n  doc.setTextColor(100);\n  doc.text(location.type || 'Type non spécifié', margin, y);\n  y += 15;\n\n  // Ligne de séparation\n  doc.setDrawColor(226, 232, 240);\n  doc.line(margin, y, pageWidth - margin, y);\n  y += 10;\n\n  // Informations\n  doc.setTextColor(0);\n  doc.setFontSize(11);\n\n  const addField = (label: string, value: string) => {\n    if (!value) return;\n    doc.setFont('helvetica', 'bold');\n    doc.text(`${label}:`, margin, y);\n    doc.setFont('helvetica', 'normal');\n    doc.text(value, margin + 35, y);\n    y += 7;\n  };\n\n  addField('Adresse', location.adresse);\n  addField('Ville', `${location.codePostal} ${location.ville}`);\n  addField('Niveau', location.niveau);\n  addField('Téléphone', location.telephone);\n  addField('Contact', location.contact);\n  addField('Email', location.email);\n\n  if (location.commentaire) {\n    y += 5;\n    doc.setFont('helvetica', 'bold');\n    doc.text('Commentaire:', margin, y);\n    y += 7;\n    doc.setFont('helvetica', 'normal');\n\n    const lines = doc.splitTextToSize(location.commentaire, pageWidth - 2 * margin);\n    doc.text(lines, margin, y);\n    y += lines.length * 5 + 5;\n  }\n\n  // Note personnelle\n  if (personalNote) {\n    y += 5;\n    doc.setFillColor(255, 251, 235);\n    doc.rect(margin, y - 3, pageWidth - 2 * margin, 30, 'F');\n\n    doc.setFont('helvetica', 'bold');\n    doc.setTextColor(146, 64, 14);\n    doc.text('Note personnelle:', margin + 3, y + 4);\n    doc.setFont('helvetica', 'normal');\n    doc.setTextColor(0);\n\n    const noteLines = doc.splitTextToSize(personalNote, pageWidth - 2 * margin - 6);\n    doc.text(noteLines, margin + 3, y + 11);\n    y += 35;\n  }\n\n  // QR Code (si demandé)\n  if (includeQRCode && location.lat && location.lon) {\n    try {\n      const QRCode = (await import('qrcode')).default;\n      const qrData = `geo:${location.lat},${location.lon}?q=${encodeURIComponent(location.nom)}`;\n      const qrDataUrl = await QRCode.toDataURL(qrData, { width: 100 });\n\n      y += 10;\n      doc.setFont('helvetica', 'bold');\n      doc.text('Localisation:', margin, y);\n      y += 5;\n\n      doc.addImage(qrDataUrl, 'PNG', margin, y, 35, 35);\n\n      doc.setFont('helvetica', 'normal');\n      doc.setFontSize(9);\n      doc.text('Scannez pour ouvrir dans', margin + 40, y + 15);\n      doc.text('votre application GPS', margin + 40, y + 20);\n    } catch (error) {\n      console.warn('Erreur génération QR code:', error);\n    }\n  }\n\n  // Pied de page\n  doc.setFontSize(8);\n  doc.setTextColor(128);\n  doc.text(\n    `Généré le ${formatDateFR()} - Carte des Lieux de Stage`,\n    margin,\n    doc.internal.pageSize.height - 10\n  );\n\n  // Télécharger\n  const filename = generateFileName(\n    location.nom.replace(/[^a-zA-Z0-9]/g, '_').substring(0, 30),\n    'pdf'\n  );\n  doc.save(filename);\n}\n\n/**\n * Exporte les données en Excel (XLSX)\n */\nexport async function exportToExcel(\n  locations: Location[],\n  filename?: string\n): Promise<void> {\n  const XLSX = await import('xlsx');\n\n  const worksheet = XLSX.utils.json_to_sheet(\n    locations.map(loc => ({\n      'Nom': loc.nom,\n      'Adresse': loc.adresse,\n      'Code Postal': loc.codePostal,\n      'Ville': loc.ville,\n      'Type': loc.type,\n      'Niveau': loc.niveau,\n      'Téléphone': loc.telephone,\n      'Contact': loc.contact,\n      'Email': loc.email,\n      'Commentaire': loc.commentaire,\n      'Latitude': loc.lat,\n      'Longitude': loc.lon\n    }))\n  );\n\n  // Ajuster la largeur des colonnes\n  worksheet['!cols'] = [\n    { wch: 30 }, // Nom\n    { wch: 35 }, // Adresse\n    { wch: 10 }, // Code Postal\n    { wch: 20 }, // Ville\n    { wch: 25 }, // Type\n    { wch: 8 },  // Niveau\n    { wch: 15 }, // Téléphone\n    { wch: 25 }, // Contact\n    { wch: 30 }, // Email\n    { wch: 40 }, // Commentaire\n    { wch: 12 }, // Latitude\n    { wch: 12 }  // Longitude\n  ];\n\n  const workbook = XLSX.utils.book_new();\n  XLSX.utils.book_append_sheet(workbook, worksheet, 'Lieux de Stage');\n\n  XLSX.writeFile(\n    workbook,\n    filename || generateFileName('lieux-stage', 'xlsx')\n  );\n}\n\n/**\n * Télécharge un fichier\n */\nfunction downloadFile(content: string, filename: string, mimeType: string): void {\n  const blob = new Blob([content], { type: mimeType });\n  const url = URL.createObjectURL(blob);\n\n  const link = document.createElement('a');\n  link.href = url;\n  link.download = filename;\n  link.style.display = 'none';\n\n  document.body.appendChild(link);\n  link.click();\n  document.body.removeChild(link);\n\n  URL.revokeObjectURL(url);\n}\n\n/**\n * Génère les données pour l'impression\n */\nexport function generatePrintContent(locations: Location[]): string {\n  return `\n    <!DOCTYPE html>\n    <html lang=\"fr\">\n    <head>\n      <meta charset=\"UTF-8\">\n      <title>Lieux de Stage</title>\n      <style>\n        body { font-family: Arial, sans-serif; font-size: 10pt; }\n        h1 { font-size: 16pt; color: #2563eb; }\n        table { width: 100%; border-collapse: collapse; margin-top: 20px; }\n        th, td { border: 1px solid #ddd; padding: 6px; text-align: left; }\n        th { background-color: #2563eb; color: white; }\n        tr:nth-child(even) { background-color: #f8fafc; }\n        .footer { margin-top: 20px; font-size: 8pt; color: #666; }\n      </style>\n    </head>\n    <body>\n      <h1>Liste des Lieux de Stage</h1>\n      <p>Export du ${formatDateFR()} - ${locations.length} établissement(s)</p>\n      <table>\n        <thead>\n          <tr>\n            <th>Nom</th>\n            <th>Adresse</th>\n            <th>Ville</th>\n            <th>Type</th>\n            <th>Niveau</th>\n            <th>Téléphone</th>\n          </tr>\n        </thead>\n        <tbody>\n          ${locations.map(loc => `\n            <tr>\n              <td>${escapeHtml(loc.nom)}</td>\n              <td>${escapeHtml(loc.adresse)}</td>\n              <td>${loc.codePostal} ${escapeHtml(loc.ville)}</td>\n              <td>${escapeHtml(loc.type)}</td>\n              <td>${loc.niveau}</td>\n              <td>${loc.telephone}</td>\n            </tr>\n          `).join('')}\n        </tbody>\n      </table>\n      <p class=\"footer\">Carte des Lieux de Stage</p>\n    </body>\n    </html>\n  `;\n}\n\nfunction escapeHtml(text: string): string {\n  if (!text) return '';\n  return text\n    .replace(/&/g, '&amp;')\n    .replace(/</g, '&lt;')\n    .replace(/>/g, '&gt;')\n    .replace(/\"/g, '&quot;');\n}\n\n/**\n * Ouvre la fenêtre d'impression\n */\nexport function printLocations(locations: Location[]): void {\n  const content = generatePrintContent(locations);\n  const printWindow = window.open('', '_blank');\n\n  if (printWindow) {\n    printWindow.document.write(content);\n    printWindow.document.close();\n    printWindow.print();\n  }\n}\n\n// ============================================================================\n// Fonctions wrapper pour compatibilité avec le store\n// ============================================================================\n\n/**\n * Export CSV avec indices filtrés\n */\nexport async function exportAsCsv(indices: number[]): Promise<void> {\n  const locations = indices.map(i => store.locations[i]).filter(Boolean);\n  exportToCSV(locations);\n}\n\n/**\n * Export JSON avec indices filtrés\n */\nexport async function exportAsJson(indices: number[]): Promise<void> {\n  const locations = indices.map(i => store.locations[i]).filter(Boolean);\n  exportToJSON(locations);\n}\n\n/**\n * Export PDF avec indices filtrés\n */\nexport async function exportAsPdf(indices: number[]): Promise<void> {\n  const locations = indices.map(i => store.locations[i]).filter(Boolean);\n  await exportToPDF(locations);\n}\n\n/**\n * Export Excel avec indices filtrés\n */\nexport async function exportAsExcel(indices: number[]): Promise<void> {\n  const locations = indices.map(i => store.locations[i]).filter(Boolean);\n  await exportToExcel(locations);\n}\n"],"file":"assets/export.service-B5insj9F.js"}